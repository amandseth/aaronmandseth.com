---
import DefaultLayout from "../layouts/DefaultLayout.astro";
import { getImage } from "@astrojs/image";
import { Image } from "@astrojs/image/components";

import ahsLogoImage from "../images/ahs.png";
import codeImage from "../images/code.png";

const codeImageProps = await getImage({
	src: codeImage,
	alt: "",
	width: 800,
	aspectRatio: 1.6,
	format: "webp",
});
---

<DefaultLayout title="Aaron Mandseth - Full stack developer">
	<main class="flex justify-center items-center h-screen w-full relative">
		<canvas id="heroCanvas"></canvas>
		<div class="z-10 row-start-2 max-w-3xl mx-auto text-center">
			<h1
				class="text-4xl font-bold text-brand-highlight text-shadow-lg mb-2"
			>
				Aaron Mandseth
			</h1>
			<h2 class="text-2xl">Full stack developer</h2>
			<div class="flex gap-4">
				<a class="flex-1 text-right" href="#about">About</a>
				<a class="flex-1 text-left" href="#contact">Contact</a>
			</div>
		</div>
	</main>
	<div class="container mx-auto">
		<section class="grid grid-cols-2 my-24">
			<div class="text-lg mt-4">
				<div>
					<h1 class="text-3xl my-2">About</h1>
					<p>
						I'm a full stack developer based in Edmonton, Alberta. I
						specialize in C#, ASP .NET Core MVC, and related
						technologies.
					</p>
					<p>
						I am currently working at Alberta Health Services, where
						I build solutions that assist healthcare workers in
						delivering quality patient care.
					</p>
					<a href="https://albertahealthservices.ca" target="_blank">
						<Image
							src={ahsLogoImage}
							alt="Alberta Health Services logo"
							width={180}
							aspectRatio={3.36}
							format="webp"
							class="mt-8"
						/>
					</a>
				</div>
			</div>
			<div class="ml-16">
				<img
					class="shadow-lg"
					src={codeImageProps.src}
					alt=""
					width="100%"
					loading="lazy"
					decoding="async"
				/>
			</div>
		</section>
		<section class="my-24">
			<h1 class="text-3xl my-2" id="contact">Contact</h1>
			<p>
				You can reach me at
				<code class="rounded-lg bg-gray-800 p-1">aaron</code>
				at
				<code class="rounded-lg bg-gray-800 p-1">aaronmandseth.com</code
				>.
			</p>
		</section>
	</div>
</DefaultLayout>

<style>
	canvas {
		position: absolute;
		width: 100%;
		height: 100%;
	}
</style>

<script>
	(() => {
		type Point = {
			x: number;
			y: number;
			z: number;
		};

		const canvas = document.getElementById(
			"heroCanvas"
		) as HTMLCanvasElement | null;
		if (!canvas) return;

		const ctx = canvas.getContext("2d");
		if (!ctx) return;

		const resizeCanvas = () => {
			canvas.width = Math.floor(
				canvas.clientWidth * window.devicePixelRatio
			);
			canvas.height = Math.floor(
				canvas.clientHeight * window.devicePixelRatio
			);
		};

		let media = matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);
		media.addEventListener("change", () => {
			resizeCanvas();
		});

		window.onresize = () => {
			resizeCanvas();
		};

		resizeCanvas();

		const points: Array<Point> = [];

		for (let i = 0; i < 1000; i++) {
			points.push({
				x: Math.random() * 1600 - 800,
				y: Math.random() * 900 - 450,
				z: Math.random() * 1000,
			});
		}

		const drawPoint = (point: Point) => {
			const intensity = (1 - point.z / 1000) * 255;
			const size = (1 - point.z / 1000) * 4;
			const cx = canvas.width / 2;
			const cy = canvas.height / 2;
			const x = cx + point.x / (point.z * 0.001);
			const y = cy + point.y / (point.z * 0.001);

			if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) {
				return;
			}

			ctx.fillStyle = `rgb(${intensity}, ${intensity}, ${intensity})`;
			ctx.fillRect(x, y, size, size);
		};

		const movePoint = (point: Point, distance: number) => {
			point.z -= distance;

			while (point.z <= 1) {
				point.z += 1000;
			}
		};

		const reducedMotion = window.matchMedia(
			"(prefers-reduced-motion: reduce)"
		);

		const clear = () => {
			const html = document.documentElement;
			const body = document.body;
			const scrollPercent =
				(html.scrollTop || body.scrollTop) /
				((html.scrollHeight || body.scrollHeight) - html.clientHeight);

			const r = scrollPercent * 22;
			const g = scrollPercent * 24;
			const b = scrollPercent * 28;

			ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
			ctx.fillRect(0, 0, canvas.width, canvas.height);
		};

		let prevTime = 0;
		const tick = (timestep: number) => {
			const delta = timestep - prevTime;
			prevTime = timestep;

			clear();

			for (let i = 0; i < points.length; i++) {
				movePoint(points[i], 0.1 * delta);
				drawPoint(points[i]);
			}

			//Disable all subsequent drawing if prefers-reduced-motion
			if (!reducedMotion.matches) {
				requestAnimationFrame(tick);
			}
		};

		requestAnimationFrame(tick);
	})();
</script>
